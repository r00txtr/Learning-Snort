# Intrusion Detection and Intrusion Prevention with Snort: A Beginner's Guide

Intrusion Detection Systems (IDS) and Intrusion Prevention Systems (IPS) are essential components in safeguarding your network against unauthorized access and potential threats. Snort, a powerful open-source tool, can function as both an IDS and an IPS, helping you monitor network traffic and take action against suspicious activities.

In this guide, we’ll walk you through setting up Snort as an IDS/IPS, creating custom rules, and analyzing logs to detect potential intrusions. By the end of this tutorial, you'll have a solid understanding of how to use Snort to protect your network.

### Prerequisites

Before we begin, ensure you have:
- A system running Ubuntu (this guide uses Ubuntu 20.04 LTS).
- Snort installed (If you haven’t installed it yet, refer to our [previous guide](#)).
- Basic familiarity with the Linux command line.
- Root or sudo access on your system.

### Step 1: Create Custom Snort Rules

Snort uses rules to define what types of network activity should be logged or blocked. Let’s create some simple rules to detect and alert on specific types of traffic.

1. **Open the Local Rules File**:

   We'll start by editing the `local.rules` file, where you can add custom Snort rules:

   ```bash
   sudo vim /etc/snort/rules/local.rules
   ```

2. **Add Custom Rules**:

   Here are two example rules:

   - **ICMP Ping Detection**: This rule generates an alert whenever an ICMP (ping) request is detected on your network.

     ```bash
     alert icmp any any -> $HOME_NET any (msg:"ICMP Ping Detected"; sid:10000001; rev:1;)
     ```

   - **SSH Authentication Attempt**: This rule generates an alert when a connection attempt is made to port 22 (typically used for SSH).

     ```bash
     alert tcp any any -> $HOME_NET 22 (msg:"SSH Authentication Attempt"; sid:10000002; rev:1;)
     ```

   After adding these rules, save the file and exit the editor.

### Step 2: Run Snort with Custom Rules

Now that you’ve created your custom rules, it's time to run Snort and see them in action.

1. **Start Snort**:

   Run Snort using the following command:

   ```bash
   sudo snort -q -l /var/log/snort -i enp0s8 -A console -c /etc/snort/snort.conf
   ```

   Here’s what each option means:
   - `-q`: Quiet mode, suppressing unnecessary output.
   - `-l /var/log/snort`: Specifies the directory where Snort will store its logs.
   - `-i enp0s8`: Specifies the network interface to monitor (replace `enp0s8` with your actual interface).
   - `-A console`: Displays alerts directly in the terminal.
   - `-c /etc/snort/snort.conf`: Specifies the path to your Snort configuration file.

2. **Generate Network Traffic**:

   To test the ICMP ping detection rule, try pinging your machine from another device:

   ```bash
   ping <Your_Machine_IP>
   ```

   You should see an alert in the terminal similar to this:

   ```
   09/03-15:45:32.000000  [**] [1:10000001:1] ICMP Ping Detected [**] [Priority: 0] {ICMP} 192.168.1.2 -> 192.168.1.10
   ```

   For the SSH rule, try connecting to your machine using SSH from another device:

   ```bash
   ssh <Your_Machine_IP>
   ```

   Snort should log an SSH authentication attempt.

### Step 3: Download and Use Community Rules

In addition to custom rules, Snort offers community rules, which are pre-built and maintained by the Snort community. These rules help detect a wide range of known threats.

1. **Download the Community Rules**:

   Use `wget` to download the latest set of community rules:

   ```bash
   wget https://www.snort.org/downloads/community/community-rules.tar.gz
   ```

2. **Extract the Rules**:

   Extract the downloaded archive:

   ```bash
   tar -xvf community-rules.tar.gz
   ```

   This will create a directory containing the rules, which you can then configure Snort to use.

3. **Run Snort with Community Rules**:

   Start Snort again, this time using the community rules:

   ```bash
   sudo snort -q -l /var/log/snort -i enp0s8 -A fast -c /etc/snort/snort.conf
   ```

   The `-A fast` option logs alerts to a file instead of displaying them on the console, which is useful for later analysis.

### Step 4: Analyze Snort Logs with Wireshark

Snort logs can be analyzed using various tools, one of the most popular being Wireshark, a network protocol analyzer that allows you to inspect captured data in detail.

1. **Install Wireshark**:

   If you don’t have Wireshark installed, you can install it using the following command:

   ```bash
   sudo apt-get install wireshark -y
   ```

2. **Open Snort Logs in Wireshark**:

   Start Wireshark with root privileges:

   ```bash
   sudo wireshark
   ```

   Open the Snort log files located in `/var/log/snort/`. Wireshark will allow you to filter, inspect, and analyze the alerts generated by Snort.

   You can apply filters in Wireshark to narrow down the traffic you’re interested in. For example, to view only ICMP traffic, you can use the filter:

   ```
   icmp
   ```

### Conclusion

Setting up Snort as an Intrusion Detection and Prevention System is a vital step in protecting your network from unauthorized access and potential threats. By creating custom rules and leveraging community rules, you can tailor Snort to meet your specific security needs. With tools like Wireshark, you can further analyze and understand the alerts generated by Snort, helping you stay ahead of potential security breaches.

This guide provided a beginner-friendly approach to using Snort, but there's always more to explore. Keep experimenting with different rules, integrating Snort with other security tools, and refining your network defenses.

If you found this guide helpful, share it with others who are interested in network security, and stay tuned for more tutorials!
